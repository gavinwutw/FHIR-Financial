<!DOCTYPE html>
<html>
<head>
  <title>postClaim</title>
  <meta charset="utf-8">
  <script src="setting.js"></script>
  <script src="HTTP2019.js"></script>

<script>
     var myObj = {
         "resourceType": "Claim",
         "use": "claim",
         "patient": {
    				"reference": "Patient/2562719"
  				},
  			 "created": "2014-08-16",
  			 "insurer": {
    				"reference": "Organization/2563340"
  				},
  			 "provider": {
    				"reference": "Organization/2563339"
  				},
  			 "priority": {
    				"coding": [
      				{
        				"code": "normal"
      				}
    				]
  				},
  			 "item": [
    				{
      				"sequence": 1,
      				"productOrService": {
        				"coding": [
          				{
            				"code": "test"
          				}
        				]
      				},
      				"servicedDate": "2014-08-16",
      				"net": {
        				"value": 135.57,
        				"currency": "TWD"
      				}
    				}
  				]
     };


     var myItem = {
     			"sequence": 1,
     			"productOrService": {
        				"coding": [
          				{
            				"text": "test"
          				}
        				]
      				},
      		"servicedDate": "2014-08-16",
      		"net": {
        				"value": 135.57,
        				"currency": "TWD"
      				}
     };
    
	 
   function postData() {
     /*   var data = myObj.valueQuantity.value;
       alert(data);  */
       myObj.patient.reference = 'Patient/'+document.getElementById("patient").value;
       myObj.created = document.getElementById("date").value;
       myObj.provider.reference =  'Organization/'+document.getElementById("provider").value;
       myObj.priority.coding[0].code = document.getElementById("priority").value;
       /*if(j==5){
       		myObj.item[0].sequence = 1;
       		myObj.item[0].productOrService.coding[0].code = document.getElementById("itemname").value;
       		myObj.item[0].servicedDate = document.getElementById("itemdate").value;
       		myObj.item[0].net.value = document.getElementById("itemprice").value;
       }*/
       /*for*/
       for (let a=1;a<(j-3);a++){
       	var b = 'itemname'+ a;
       	var c = 'itemdate' + a;
       	var d = 'itemprice' + a;
       	myObj.item[a-1].sequence = a;
       	myObj.item[a-1].productOrService.coding[0].code = document.getElementById(b).value;
       	myObj.item[a-1].servicedDate = document.getElementById(c).value;
       	myObj.item[a-1].net.value = document.getElementById(d).value;
       }
       /*
       let a =1;
       	  while (a < (j-3)) {
       	  	var b = 'itemname'+ a;
       	  	var c = 'itemdate' + a;
       	  	var d = 'itemprice' + a;
       	  	myObj.item[a-1].sequence = a;
       	  	console.log(myObj.item[a-1]);
       	  	myObj.item[a-1].productOrService.coding[0].code = document.getElementById(b).value;
       	  	myObj.item[a-1].servicedDate = document.getElementById(c).value;
       	  	myObj.item[a-1].net.value = document.getElementById(d).value;
       	  	a++;
       	  }*/
       /*if(document.getElementById("genderMale").checked == true)
           {myObj.gender = "male";    }
       else if(document.getElementById("genderFemale").checked == true)
           {myObj.gender = "female";    }*/  

       var jsonStr = JSON.stringify(myObj);
       alert(jsonStr);

       var apiURL;
       apiURL = FHIRrootURL + '/' + "Claim";
     //  alert(apiURL);
       HTTPPostData(apiURL, jsonStr);
     
	

	}


</script>	

<style>
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}
th, td {
    padding: 5px;
    text-align: left;    
}
</style>
</head>
<body>
<div align="center">
  <h2 align="center">申報模擬<br>CLAIM FORMULATION</h2>


<table style="width:90%" id="myTable">
  <tr>
	  <th colspan="4">A.申請人資料</th>
  </tr>
  <tr>
    <td>
		1.申請人<br>
		<input type="text" id="patient" placeholder="請直接輸入申報人id" />
	</td>
	<td>
		2.請款單位<br>
		<input type="text" id="provider" placeholder="請直接輸入請款單位id" />
	</td>
	<td>
		3.請款日期<br>
		<input type="date" id="date" />
	</td>
	<td>
		4.優先程度<br>
		<select id="priority">
			<option value="stat">優先 Immediate</option>
			<option value="normal">正常 Normal</option>
			<option value="deferred">緩 Deferred</option>
		</select>
	</td>
  </tr>
  <tr>
	  <th colspan="4">
	  B.請款項目
	<button onclick="myCreateFunction()">+</button>
	<button onclick="myDeleteFunction()">-</button>
	  </th>
  </tr>
  <tr>
	<th><center>No.</center></th>
	<th><center>名稱</center></th>
	<th><center>日期</center></th>
	<th><center>金額</center></th>
  </tr>
  <tr>
	  <td><center>1</center></td>
	  <td>
	  	<center><input type="text" id="itemname1" /></center>
	  </td>
	  <td>
	  	<center><input type="date" id="itemdate1" /></center>
	  </td>
	  <td>
	  	<center><input type="text" id="itemprice1" /></center>
	  </td>
  </tr>
  <tr>
	  <th colspan="4">備註與須知</th>
  </tr>
  <tr>
	  <td colspan="4">
		<ul>
			<li>申請人id使用:<a href="http://hapi.fhir.org/baseR4/Patient/2562719">2562719</a></li>
			<li>請款單位id使用：2563339(子組織1)</li>
			<li>insurer不需輸入已固定為id:2563340(子組織2)</li>
			<li>主組織id:2563338</li>
		</ul>
	  </td>
  </tr>
  <tr>
	<td colspan="4">
  		<center>
			<input id="Button1" onclick="postData()" type="button" value="提交">
			<input type="reset" value="清除">
			<button onclick="myAlertFunction()">測試</button>
		</center>
	</td>
  </tr>
</table>
</div>
</body>
<script>
	var i = 1;
	var j = 5;
	function myCreateFunction() {
		/*myObj.item.push(myItem);*/
		/*myObj.item[myObj.item.length]=myItem;*/
		myObj.item.push(myItem);
		i = i+1;
  	j = j+1;
  	var table = document.getElementById("myTable");
  	var row = table.insertRow(j-1);
  	var cell1 = row.insertCell(0);
  	var cell2 = row.insertCell(1);
  	var cell3 = row.insertCell(2);
  	var cell4 = row.insertCell(3);
	cell1.innerHTML = '<center>'+i+'</center>';
	cell2.innerHTML = '<center><input type="text" id="itemname'+i+'" /></center>';
	cell3.innerHTML = '<center><input type="date" id="itemdate'+i+'"/></center>';
	cell4.innerHTML = '<center><input type="text" id="itemprice'+i+'" /></center>';
	}

function myDeleteFunction() {
	if (j <= 5) {
		alert("申請項目須至少一項。")
	}
	else {
  document.getElementById("myTable").deleteRow(j-1);
  /*myObj.item.splice(-1,1);*/
  myObj.item.pop();
  i = i-1;
  j = j-1;
	}
}

function myAlertFunction() {
	/*alert(j);*/
	/*alert(document.getElementById("itemdate").value);*/
	alert(j);
}
</script>

</html>
